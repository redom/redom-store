function parseQuery(a){for(var b,c=!1,d=!1,e="",f="",g="",h=0;h<a.length;h++)b=a[h],"."===b?(d=!0,c=!1,0<g.length&&(g+=" ")):"#"===b?(c=!0,d=!1):c?f+=b:d?g+=b:e+=b;return{tag:e||"div",id:f,className:g}}function createElement(a,b){var c=parseQuery(a),d=c.tag,e=c.id,f=c.className,g=b?document.createElementNS(b,d):document.createElement(d);return e&&(g.id=e),f&&(b?g.setAttribute("class",f):g.className=f),g}function unmount(a,b){var c=getEl(a),d=getEl(b);return b===d&&d.__redom_view&&(b=d.__redom_view),d.parentNode&&(doUnmount(b,d,c),c.removeChild(d)),b}function doUnmount(a,b,c){var d=b.__redom_lifecycle;if(hooksAreEmpty(d))return void(b.__redom_lifecycle={});var e=c;for(b.__redom_mounted&&trigger(b,"onunmount");e;){var f=e.__redom_lifecycle||{};for(var g in d)f[g]&&(f[g]-=d[g]);hooksAreEmpty(f)&&(e.__redom_lifecycle=null),e=e.parentNode}}function hooksAreEmpty(a){if(null==a)return!0;for(var b in a)if(a[b])return!1;return!0}/* global Node, ShadowRoot */var hookNames=["onmount","onremount","onunmount"],shadowRootAvailable="undefined"!=typeof window&&"ShadowRoot"in window;function mount(a,b,c,d){var e=getEl(a),f=getEl(b);b===f&&f.__redom_view&&(b=f.__redom_view),b!==f&&(f.__redom_view=b);var g=f.__redom_mounted,h=f.parentNode;return g&&h!==e&&doUnmount(b,f,h),null==c?e.appendChild(f):d?e.replaceChild(f,getEl(c)):e.insertBefore(f,getEl(c)),doMount(b,f,e,h),b}function trigger(a,b){"onmount"===b||"onremount"===b?a.__redom_mounted=!0:"onunmount"===b&&(a.__redom_mounted=!1);var c=a.__redom_lifecycle;if(c){var d=a.__redom_view,e=0;for(var f in d&&d[b]&&d[b](),c)f&&e++;if(e)for(var g,h=a.firstChild;h;)g=h.nextSibling,trigger(h,b),h=g}}function doMount(a,b,c,d){for(var e,f=b.__redom_lifecycle||(b.__redom_lifecycle={}),g=c===d,h=!1,j=0,k=hookNames;j<k.length;j+=1)e=k[j],!g&&a!==b&&e in a&&(f[e]=(f[e]||0)+1),f[e]&&(h=!0);if(!h)return void(b.__redom_lifecycle={});var l=c,m=!1;for((g||l&&l.__redom_mounted)&&(trigger(b,g?"onremount":"onmount"),m=!0);l;){var n=l.parentNode,o=l.__redom_lifecycle||(l.__redom_lifecycle={});for(var p in f)o[p]=(o[p]||0)+f[p];if(m)break;else(l.nodeType===Node.DOCUMENT_NODE||shadowRootAvailable&&l instanceof ShadowRoot||n&&n.__redom_mounted)&&(trigger(l,g?"onremount":"onmount"),m=!0),l=n}}function setStyle(a,b,c){var d=getEl(a);if("object"==typeof b)for(var e in b)setStyleValue(d,e,b[e]);else setStyleValue(d,b,c)}function setStyleValue(a,b,c){a.style[b]=null==c?"":c}/* global SVGElement */var xlinkns="http://www.w3.org/1999/xlink";function setAttrInternal(a,b,c,d){var e=getEl(a);if("object"==typeof b)for(var f in b)setAttrInternal(e,f,b[f],d);else{var g=e instanceof SVGElement,h="function"==typeof c;if("style"===b&&"object"==typeof c)setStyle(e,c);else if(g&&h)e[b]=c;else if("dataset"===b)setData(e,c);else if(!g&&(b in e||h)&&"list"!==b)e[b]=c;else{if(g&&"xlink"===b)return void setXlink(e,c);d&&"class"===b&&(c=e.className+" "+c),null==c?e.removeAttribute(b):e.setAttribute(b,c)}}}function setXlink(a,b,c){if("object"==typeof b)for(var d in b)setXlink(a,d,b[d]);else null==c?a.removeAttributeNS(xlinkns,b,c):a.setAttributeNS(xlinkns,b,c)}function setData(a,b,c){if("object"==typeof b)for(var d in b)setData(a,d,b[d]);else null==c?delete a.dataset[b]:a.dataset[b]=c}function text(a){return document.createTextNode(null==a?"":a)}function parseArgumentsInternal(a,b,c){for(var d,e=0,f=b;e<f.length;e+=1)if(d=f[e],0===d||d){var g=typeof d;"function"==g?d(a):"string"===g||"number"===g?a.appendChild(text(d)):isNode(getEl(d))?mount(a,d):d.length?parseArgumentsInternal(a,d,c):"object"===g&&setAttrInternal(a,d,null,c)}}function ensureEl(a){return"string"==typeof a?html(a):getEl(a)}function getEl(a){return a.nodeType&&a||!a.el&&a||getEl(a.el)}function isNode(a){return a&&a.nodeType}var htmlCache={};function html(a){for(var b=[],c=arguments.length-1;0<c--;)b[c]=arguments[c+1];var d,e=typeof a;if("string"===e)d=memoizeHTML(a).cloneNode(!1);else if(isNode(a))d=a.cloneNode(!1);else if("function"===e){d=new(Function.prototype.bind.apply(a,[null].concat(b)))}else throw new Error("At least one argument required");return parseArgumentsInternal(getEl(d),b,!0),d}var el=html;html.extend=function(a){for(var b=[],c=arguments.length-1;0<c--;)b[c]=arguments[c+1];var d=memoizeHTML(a);return html.bind.apply(html,[this,d].concat(b))};function memoizeHTML(a){return htmlCache[a]||(htmlCache[a]=createElement(a))}function setChildren(a){for(var b=[],c=arguments.length-1;0<c--;)b[c]=arguments[c+1];for(var d=getEl(a),e=traverse(a,b,d.firstChild);e;){var f=e.nextSibling;unmount(a,e),e=f}}function traverse(a,b,c){for(var d=c,e=Array(b.length),f=0;f<b.length;f++)e[f]=b[f]&&getEl(b[f]);for(var g,h=0;h<b.length;h++)if(g=b[h],!!g){var j=e[h];if(j===d){d=d.nextSibling;continue}if(isNode(j)){var k=d&&d.nextSibling,l=null!=g.__redom_index,m=l&&k===e[h+1];mount(a,g,d,m),m&&(d=k);continue}null!=g.length&&(d=traverse(a,g,d))}return d}var ListPool=function(a,b,c){this.View=a,this.initData=c,this.oldLookup={},this.lookup={},this.oldViews=[],this.views=[],null!=b&&(this.key="function"==typeof b?b:propKey(b))};ListPool.prototype.update=function(a,b){for(var c=this,d=c.View,e=c.key,f=c.initData,g=this.lookup,h={},j=Array(a.length),k=this.views,l=0;l<a.length;l++){var m=a[l],n=void 0;if(null!=e){var o=e(m);n=g[o]||new d(f,m,l,a),h[o]=n,n.__redom_id=o}else n=k[l]||new d(f,m,l,a);n.update&&n.update(m,l,a,b);var p=getEl(n.el);p.__redom_view=n,j[l]=n}this.oldViews=k,this.views=j,this.oldLookup=g,this.lookup=h};function propKey(a){return function(b){return b[a]}}var List=function(a,b,c,d){this.__redom_list=!0,this.View=b,this.initData=d,this.views=[],this.pool=new ListPool(b,c,d),this.el=ensureEl(a),this.keySet=null!=c};List.prototype.update=function(a,b){void 0===a&&(a=[]);var c=this,d=c.keySet,e=this.views;this.pool.update(a,b);var f=this.pool,g=f.views,h=f.lookup;if(d)for(var j=0;j<e.length;j++){var k=e[j],l=k.__redom_id;null==h[l]&&(k.__redom_index=null,unmount(this,k))}for(var m,n=0;n<g.length;n++)m=g[n],m.__redom_index=n;setChildren(this,g),d&&(this.lookup=h),this.views=g},List.extend=function(a,b,c,d){return List.bind(List,a,b,c,d)};var commonjsGlobal="undefined"==typeof globalThis?"undefined"==typeof window?"undefined"==typeof global?"undefined"==typeof self?{}:self:global:window:globalThis;function createCommonjsModule(a,b){return b={exports:{}},a(b,b.exports),b.exports}var redomStore=createCommonjsModule(function(c){(function(d,a){c.exports=a()})(commonjsGlobal,function(){function e(d,a){for(let b in a)d[b]=a[b];return d}return class{constructor(b){this.listeners=[],this.state=b||{}}subscribe(b){return this.listeners.push(b),()=>{this.unsubscribe(b)}}unsubscribe(d){let e=[];for(let a=0;a<this.listeners.length;a++)this.listeners[a]===d?d=null:e.push(this.listeners[a]);this.listeners=e}setState(a,b){this.state=e(e({},this.state),a);let c=this.listeners;for(let d=0;d<c.length;d++)c[d](this.state,b)}getState(){return this.state}dispatch(b){}}})});const state={count:0},store=new redomStore(state);class Counter{constructor(a){this.store=a,this.el=el("div",{},el("button",{onclick:()=>this.action("INCREMENT")},"Increment"),el("button",{onclick:()=>this.action("DECREMENT")},"Decrement"),el("button",{onclick:()=>this.action("INCREMENT_IF_ODD")},"Increment if odd"),el("button",{onclick:()=>this.action("INCREMENT_ASYNC")},"Increment async"))}action(a){let{count:b}=this.store.getState();switch(a){case"INCREMENT":this.store.setState({count:++b});break;case"DECREMENT":this.store.setState({count:--b});break;case"INCREMENT_IF_ODD":0==(b+1)%2&&this.store.setState({count:++b});break;case"INCREMENT_ASYNC":return new Promise(a=>{setTimeout(()=>{this.store.setState({count:++b}),a()},1e3)});}}}class Reset{constructor(a){this.store=a;let{count:b}=this.store.getState();this.el=el("div",{},el("button",{onclick:()=>this.store.setState({count:b})},"Reset"))}}class Result{constructor(a){this.store=a;const{count:b}=this.store.getState();this.el=el("div",el("h2",{style:{color:"#d31b33"}},"Number of clicks: ",this.result=el("span",{style:{color:"#000"}},b))),this.store.subscribe(a=>{this.result.textContent=a.count})}}const App=el("div#app",new Counter(store),new Result(store),new Reset(store));mount(document.body,App);
